[![en](https://img.shields.io/badge/lang-en-red.svg)](https://github.com/qwatro2/kpv-flames/blob/main/README.md)
[![pt-br](https://img.shields.io/badge/lang-ru-green.svg)](https://github.com/qwatro2/kpv-flames/blob/main/README.ru.md)

# Фрактальное пламя
<img src=images/title.png width="400" height="400"  alt="title-image"/>

## Как пользоваться?
Можно запустить с флагом `--help` и посмотреть подсказку
### Параметры
|        Параметр        |        Тип         |                    Описание                    |   Значение по умолчанию   |
|:----------------------:|:------------------:|:----------------------------------------------:|:-------------------------:|
|     `--n-samples`      |      int > 0       |               количество сэмплов               |           1000            |
|    `--n-iterations`    |      int > 0       |      количество итераций с каждым сэмплом      |          100000           |
|    `--n-symmetries`    |      int > 0       |         количество круговых симметрий          |     1 (без симметрий)     |
| `--n-transformations`  |      int > 0       |       количество аффинных преобразований       |            10             |
|     `--n-threads`      |      int > 0       |   количество потоков в многопоточном режиме    | null (однопоточный режим) |
|       `--width`        |      int > 0       |     ширина готового изображения в пикселях     |            900            |
|       `--height`       |      int > 0       |     высота готового изображения в пикселях     |            900            |
|        `--seed`        |        long        |         семя генерации случайных чисел         |     null (без семени)     |
|        `--path`        |       string       |    путь к файлу для сохранения изображения     |       ./result.png        |
|       `--format`       | png \| jpeg \| bmp |         формат сохранения изображения          |            png            |
|  `--generation-order`  | ordered \| random  |  порядок применения нелинейных преобразований  |          ordered          |
| `--add-transformation` |       string       | добавления нелинейного преобразование в список |             -             |

### `--add-transformation`
+ принимает одну из строк: `disk`, `eyefish`, `handkerchief`, `hearth`, `horseshoe`, `polar`, `sinus`, `sphere`, `swirl`
+ добавляет к списку нелинейных трансформаций указанную трансформацию
+ может применяться любое количество раз, но не меньше одного

### Пример использования
```bash
java -jar ./fractals.jar --add-transformation disk --add-transformation swirl --path ./images/flame.png --seed 142857
```

## Что происходит внутри?
Управляющей сущностью является `FractalsApp` унаследованный от `AbstractFractalsApp` \
В методе `void run(String[] args)` выстраивается следующий pipeline:
1. Получаем сущность `ParamsGetter`
2. С ее помощью получаем параметры `Params`
3. Проверяем корректность параметров
   1. Если некорректные, завершаем работу
4. Получаем сущность `ImageRenderer`
5. С ее помощью генерируем изображение `PixelImage`
6. Получаем сущность `ImageCorrector`
7. Корректируем полученное на 5 шаге изображение
8. Получаем сущность `ImageSaver`
9. Сохраняем изображение
10. Проверяем корректность сохранения

### Немного про архитектуру
Абстракция `AbstractFractalsApp` фиксирует только указанный выше pipeline, 
все остальные методы абстрактные, возвращают интерфейсный тип и должны быть переопределены. \
Это позволяет пользователю унаследоваться от этого класса и самостоятельно решить, 
какие именно реализации данных интерфейсов ему нужны

## Замеры времени
Я провел 5 замеров с разным количеством используемых потоков при прочих равных параметрах:
### Замер #1
|               Версия               | Время в миллисекундах |
|:----------------------------------:|:---------------------:|
|        Однопоточная версия         |         3137          |
|   Многопоточная версия (1 поток)   |         2568          |
|  Многопоточная версия (2 потока)   |         2703          |
|  Многопоточная версия (5 потоков)  |         1101          |
| Многопоточная версия (10 потоков)  |         1061          |
| Многопоточная версия (100 потоков) |         1044          |

### Замер #2
|               Версия               | Время в миллисекундах |
|:----------------------------------:|:---------------------:|
|        Однопоточная версия         |         2766          |
|   Многопоточная версия (1 поток)   |         2501          |
|  Многопоточная версия (2 потока)   |         2654          |
|  Многопоточная версия (5 потоков)  |         1137          |
| Многопоточная версия (10 потоков)  |          973          |
| Многопоточная версия (100 потоков) |          947          |

### Замер #3
|               Версия               | Время в миллисекундах |
|:----------------------------------:|:---------------------:|
|        Однопоточная версия         |         3136          |
|   Многопоточная версия (1 поток)   |         2735          |
|  Многопоточная версия (2 потока)   |         2945          |
|  Многопоточная версия (5 потоков)  |         1145          |
| Многопоточная версия (10 потоков)  |          975          |
| Многопоточная версия (100 потоков) |         1044          |

### Замер #4
|               Версия               | Время в миллисекундах |
|:----------------------------------:|:---------------------:|
|        Однопоточная версия         |         2927          |
|   Многопоточная версия (1 поток)   |         2439          |
|  Многопоточная версия (2 потока)   |         2439          |
|  Многопоточная версия (5 потоков)  |         1125          |
| Многопоточная версия (10 потоков)  |         1002          |
| Многопоточная версия (100 потоков) |         1004          |

### Замер #5
|               Версия               | Время в миллисекундах |
|:----------------------------------:|:---------------------:|
|        Однопоточная версия         |         3213          |
|   Многопоточная версия (1 поток)   |         2639          |
|  Многопоточная версия (2 потока)   |         2438          |
|  Многопоточная версия (5 потоков)  |         1155          |
| Многопоточная версия (10 потоков)  |         1095          |
| Многопоточная версия (100 потоков) |         1079          |

### Среднее время по 5 замерам
|               Версия               | Время в миллисекундах |
|:----------------------------------:|:---------------------:|
|        Однопоточная версия         |        3035.8         |
|   Многопоточная версия (1 поток)   |        2576.4         |
|  Многопоточная версия (2 потока)   |        2635.8         |
|  Многопоточная версия (5 потоков)  |        1132.6         |
| Многопоточная версия (10 потоков)  |        1021.2         |
| Многопоточная версия (100 потоков) |        1023.6         |

### Выводы и закономерности
+ однопоточная версия программы работает медленнее многопоточной с 1 потоком
+ версия с 2 потоками в среднем работает дольше, чем версия с 1 потоком, но все равно быстрее однопоточной
+ версия с 5 потоками работает в 3 раза быстрее, чем однопоточная
+ версия с 10 потоками уже не дает такого большого прироста в скорости
+ версия со 100 потоками в среднем работает немного хуже, чем версия с 10. 
Скорее всего это связано с тем, что слишком много времени тратится на ожидание ресурсов и переключение контекстов

## Лайки
<img src=images/likes/on_title.png width="500" height="800"  alt="title-image"/>
<img src=images/likes/ten_images.png width="400" height="800"  alt="title-image"/>

## Красивые картинки
<img src=images/fractals/1.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/2.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/3.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/4.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/5.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/6.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/7.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/8.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/9.png width="400" height="400"  alt="title-image"/>
<img src=images/fractals/10.png width="400" height="400"  alt="title-image"/>

